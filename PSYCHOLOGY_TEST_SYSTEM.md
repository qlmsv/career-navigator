# Система создания психологических тестов

## Обзор

Платформа теперь поддерживает создание сложных психологических тестов с матричными вопросами, весами и обратными вопросами. Система предназначена для создания тестов типа HEXACO, Big Five, и других психометрических инструментов.

## Основные возможности

### 1. Матричные вопросы
- **Шкалы Лайкерта** (5-балльная, 7-балльная)
- **Шкалы частоты** (Никогда - Всегда)
- **Шкалы согласия** (6-балльная без нейтрального варианта)
- **Шкалы уверенности** (4-балльная)

### 2. Веса вопросов
- Каждый вопрос может иметь вес от 0.1 до 5.0
- Веса влияют на итоговый балл по факторам
- Позволяет создавать более точные измерения

### 3. Обратные вопросы
- Вопросы с флагом `is_reverse: true`
- Автоматическая инверсия оценки при подсчете
- Важно для валидности психологических тестов

### 4. Факторы личности
- Предустановленные факторы HEXACO
- Поддержка Big Five
- Возможность создания кастомных факторов
- Интерпретация результатов по уровням (низкий/средний/высокий)

## Структура базы данных

### Таблицы для психологических тестов

```sql
-- Факторы личности
personality_factors (
  id, name, display_name, description,
  low_description, medium_description, high_description,
  order_index
)

-- Шкалы оценок
rating_scales (
  id, name, min_value, max_value, labels, description
)

-- Вопросы (расширенные)
questions (
  -- ... стандартные поля ...
  factor_id, rating_scale_id,
  scale_min, scale_max, scale_labels,
  weight, is_reverse
)

-- Попытки прохождения (расширенные)
test_attempts (
  -- ... стандартные поля ...
  factor_scores JSONB
)
```

## API Endpoints

### Создание психологических тестов
```
POST /api/tests/psychology
```

### Завершение психологического теста
```
POST /api/tests/[id]/psychology-complete
```

### Управление факторами
```
GET/POST /api/personality-factors
```

### Управление шкалами
```
GET/POST /api/rating-scales
```

### Инициализация данных
```
POST /api/seed-psychology-data
```

## Использование

### 1. Создание теста

Перейдите на `/admin/tests/create-psychology` для создания психологического теста.

**Основные настройки:**
- Название и описание теста
- Категория и время прохождения
- Проходной балл
- Настройки публичности

**Вопросы:**
- Текст вопроса
- Выбор фактора личности
- Выбор шкалы оценок
- Установка веса вопроса
- Флаг обратного вопроса
- Объяснение (опционально)

### 2. Прохождение теста

Пользователи проходят тест на `/tests/[id]/psychology`.

**Особенности интерфейса:**
- Матричное отображение шкал
- Визуальные индикаторы прогресса
- Таймер (если установлен)
- Валидация обязательных вопросов

### 3. Результаты

Результаты включают:
- Общий балл и процент
- Баллы по факторам личности
- Интерпретация по уровням
- Детальная статистика

## Предустановленные данные

### Факторы HEXACO
1. **Честность-скромность** (Honesty-Humility)
2. **Эмоциональность** (Emotionality)
3. **Экстраверсия** (Extraversion)
4. **Доброжелательность** (Agreeableness)
5. **Добросовестность** (Conscientiousness)
6. **Открытость опыту** (Openness)

### Дополнительные факторы
- Нейротизм
- Напористость
- Сотрудничество

### Шкалы оценок
- **5-балльная Лайкерта**: Полностью не согласен → Полностью согласен
- **7-балльная Лайкерта**: Расширенная версия с дополнительными градациями
- **Шкала частоты**: Никогда → Всегда
- **6-балльная согласия**: Без нейтрального варианта
- **4-балльная уверенности**: Совсем не уверен → Полностью уверен

## Логика подсчета баллов

### 1. Базовый расчет
```javascript
// Для каждого вопроса
let adjustedValue = ratingValue
if (question.is_reverse) {
  adjustedValue = question.scale_max - ratingValue + question.scale_min
}

const weightedValue = adjustedValue * question.weight
```

### 2. Нормализация по факторам
```javascript
const normalizedScore = (factorScore / maxPossibleScore) * 100
```

### 3. Интерпретация
- **0-40**: Низкий уровень
- **41-59**: Средний уровень  
- **60-100**: Высокий уровень

## Примеры использования

### HEXACO тест
1. Создайте тест с типом "psychology"
2. Добавьте 100 вопросов с факторами HEXACO
3. Используйте 5-балльную шкалу Лайкерта
4. Установите веса вопросов (обычно 1.0)
5. Отметьте обратные вопросы

### Big Five тест
1. Создайте тест с 5 факторами Big Five
2. Используйте 7-балльную шкалу для точности
3. Настройте веса в зависимости от важности вопросов

### Кастомный тест
1. Создайте собственные факторы
2. Настройте кастомные шкалы
3. Используйте различные веса для вопросов

## Технические детали

### Компоненты
- `PsychologyTestBuilder` - конструктор тестов
- `PsychologyQuestion` - отображение вопросов
- `PsychologyTestPage` - страница прохождения

### API маршруты
- `/api/tests/psychology` - CRUD для психологических тестов
- `/api/tests/[id]/psychology-complete` - завершение с продвинутой логикой
- `/api/personality-factors` - управление факторами
- `/api/rating-scales` - управление шкалами

### База данных
- Поддержка JSONB для гибкого хранения
- Индексы для быстрого поиска
- Валидация данных на уровне БД

## Развертывание

1. Выполните миграции базы данных
2. Запустите инициализацию данных:
   ```bash
   curl -X POST "/api/seed-psychology-data"
   ```
3. Создайте первый психологический тест
4. Протестируйте функциональность

## Будущие улучшения

- [ ] Адаптивное тестирование
- [ ] Нормативные данные по популяциям
- [ ] Экспорт результатов в PDF
- [ ] Интеграция с внешними системами
- [ ] Машинное обучение для интерпретации
- [ ] Многоязычная поддержка
